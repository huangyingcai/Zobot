C51 COMPILER V9.00   MAIN                                                                  12/06/2012 22:52:07 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c LARGE BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "STC12C5410AD.H"
   2          
   3          #define MESSAGE_END 'Z'
   4           
   5          
   6          /*
   7                  串口信息开头标识：
   8                  A：左前
   9                  B：左后
  10                  C：右前
  11                  D：右后
  12          
  13                  串口信息结束标识：
  14                  Z
  15          
  16          */
  17          
  18          
  19          sbit LED = P2 ^ 1;
  20          sbit ENA = P2 ^ 2;
  21          
  22          volatile unsigned char SPEED;
  23          volatile unsigned char _cReceive;
  24          volatile char _pReceive[255];
  25          
  26          
  27          
  28          
  29          void InitUART  (void)
  30          {
  31   1              //AUXR1 |= 0x80; //切换第二个串口，后期采用STC12C5412AD，使用默认的串口不再切换
  32   1              SCON = 0x50;
  33   1              TMOD|= 0x20; //定时器1工作方式
  34   1              TH1 = 0xFD;
  35   1              TL1 = 0xFD;
  36   1              TR1 = 1;
  37   1              REN = 1;
  38   1              ES = 1; //允许串行口中断
  39   1              EA = 1; //开启总中断
  40   1      }
  41          
  42          
  43          
  44          void PWM_INIT (void) {
  45   1              CMOD = 0x02;
  46   1              CL = 0x00;
  47   1              CH = 0x00;
  48   1              CCAPM0 = 0x42; 
  49   1              CCAP0L = 0x00;
  50   1              CCAP0H = 0x00;
  51   1      
  52   1              CCAPM1 = 0x42; 
  53   1              CCAP1L = 0x00;
  54   1              CCAP1H = 0x00;
  55   1      
C51 COMPILER V9.00   MAIN                                                                  12/06/2012 22:52:07 PAGE 2   

  56   1              CCAPM2 = 0x42; 
  57   1              CCAP2L = 0x00;
  58   1              CCAP2H = 0x00;
  59   1      
  60   1              CCAPM3 = 0x42; 
  61   1              CCAP3L = 0x00;
  62   1              CCAP3H = 0x00;
  63   1      
  64   1              CR = 1;
  65   1      }
  66          
  67          void PWM0_SET (unsigned char a /* 0~255 */) {
  68   1              CCAP0L = a;
  69   1              CCAP0H = a;
  70   1      }
  71          
  72          
  73          void PWM1_SET (unsigned char a /* 0~255 */) {
  74   1              CCAP1L = a;
  75   1              CCAP1H = a;
  76   1      }
  77          
  78          void PWM2_SET (unsigned char a /* 0~255 */) {
  79   1              CCAP2L = a;
  80   1              CCAP2H = a;
  81   1      }
  82          
  83          void PWM3_SET (unsigned char a /* 0~255 */) {
  84   1              CCAP3L = a;
  85   1              CCAP3H = a;
  86   1      }
  87          
  88          void main (void)
  89          {
  90   1              ENA = 1;
  91   1              InitUART();
  92   1              PWM_INIT();
  93   1      
  94   1              _cReceive = 0;
  95   1              LED = 0;
  96   1              SPEED = 0;
  97   1              //PWM0_SET(200);
  98   1              PWM1_SET(255);
  99   1              //PWM2_SET(255);
 100   1              PWM3_SET(40);
 101   1      
 102   1              while(1){}
 103   1      }
 104          
 105          
 106          void serial_interrupt (void) interrupt 4 using 3
 107          {
 108   1              unsigned char i;
 109   1              unsigned int j = 0;
 110   1      
 111   1              _pReceive[++_cReceive] = SBUF;
 112   1              if (_pReceive[_cReceive] == 'S') {
 113   2                      _cReceive = 0;  
 114   2              }
 115   1              
 116   1              if (_pReceive[_cReceive] == MESSAGE_END) {
 117   2                      
C51 COMPILER V9.00   MAIN                                                                  12/06/2012 22:52:07 PAGE 3   

 118   2                      j=1;
 119   2                      SPEED = 0;
 120   2                      for (i = _cReceive - 1; i > 0; i--)
 121   2                      {
 122   3                              SPEED += (_pReceive[i] - '0') * j;
 123   3                              j *= 10;
 124   3                      }       
 125   2                      PWM3_SET(SPEED);
 126   2              }
 127   1               
 128   1              RI = 0;
 129   1      }
 130                  


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    289    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    257       2
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
